<html>

	<head>
		<title>Aeriform</title>
        <link rel="icon" type="image/x-icon" href="favicon.png">
	</head>

	<body
        style="
            background-color: black;
            margin: 0;
            height: 100%;
            width: 100%;
            justify-content: center;
            align-items: center;
        ">

        <link rel="stylesheet" href="style.css">

        <script src="ThreeMin.js"></script>
        <script src="3js/loaders/GLTFLoader.js"></script>
        <script src="3js/loaders/FontLoader.js"></script>
        <script src="3js/controls/FirstPersonControls.js"></script>
        <script src="3js/geometries/TextGeometry.js"></script>
        
        <script> 
            const sleep = sec => new Promise(r => setTimeout(r, sec*1_000))

            const camera_placings = [
                [1.0066544111402496, -0.08902988937746323, -10.828732975955903, 0.017285800040492433, -0.2468450125445477, 0.004106891538857817],



                [1.9624814900953604, -0.34813245469953147, -15.466418047956898, 0.07227542077054726, -0.2484735210153035, 0.017803440341616527],
            ] 
                // [0.9001129996291835, -0.44667495571716836, -12.726222640853901, 0.10841063274123983, -0.17786858959131863, 0.01925445144624984],
                // [1.827566140670746, -0.40457597671216744, -13.384445504435558, 0.04315208464779503, -0.0878911038220728, 0.003790137950046403],
                // [2.0774814900953604, -0.34813245469953147, -15.206418047956898, 0.07227542077054726, -0.2484735210153035, 0.017803440341616527],
                // 

            function place_camera(camera_placing) {
                camera.position.x = camera_placing[0]
                camera.position.y = camera_placing[1] 
                camera.position.z = camera_placing[2] 
                camera.rotation.x = camera_placing[3] 
                camera.rotation.y = camera_placing[4] 
                camera.rotation.z = camera_placing[5] 
            }
            function displace_camera(camera_placing) {
                camera.position.x += camera_placing[0]
                camera.position.y += camera_placing[1] 
                camera.position.z += camera_placing[2] 
                camera.rotation.x += camera_placing[3] 
                camera.rotation.y += camera_placing[4] 
                camera.rotation.z += camera_placing[5] 
            }

        </script>

		<script>

            const renderer = new THREE.WebGLRenderer({ antialias: true} )
            document.body.appendChild(renderer.domElement)
			renderer.setSize(window.innerWidth, window.innerHeight)

			const scene = new THREE.Scene()

			const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000)
            place_camera(camera_placings[0])

            // const controls = new THREE.OrbitControls(camera, renderer.domElement)
            // controls.minDistance = 0
            // controls.maxDistance = 99999999

            const controls = new THREE.FirstPersonControls(camera, renderer.domElement)
            controls.movementSpeed = 0//.6
            controls.lookSpeed = 0//.01

            const light = new THREE.AmbientLight()
            light.castShadow = true
            scene.add(light)

			// const geometry = new THREE.BoxGeometry( 1, 1, 1 )
			// const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )
			// const cube = new THREE.Mesh( geometry, material )
			// scene.add(cube)

            const loader = new THREE.GLTFLoader()

            var model_shrine
            loader.load('shrine.glb', function ( gltf ) {
                model_shrine = gltf.scene
                model_shrine.rotateY(Math.PI/2)
                scene.add(model_shrine)
            })

            // var model_stairs
            // loader.load('stairs.glb', function ( gltf ) {
            //     model_stairs = gltf.scene
            //     model_stairs.rotateY(-45)
            //     model_stairs.position.y = -6
            //     model_stairs.position.x = -18.6
            //     model_stairs.position.z = -2.8
            //     scene.add(model_stairs)
            // })

            var model_spirit
            // loader.load('spirit.glb', function ( gltf ) {
            //     model_spirit = gltf.scene
            //     model_spirit.rotateX(Math.PI/2)
            //     //scene.add(model_spirit)
            //     mixer = new THREE.AnimationMixer( model_spirit )
			// 	mixer.clipAction( gltf.animations[ 2 ] ).play()
            //     model_spirit.name = "model_spirit"
            // })
            
            const clock = new THREE.Clock()
            var mixer = null

            var flight_record = []

			function update() {

                var delta = clock.getDelta()

                requestAnimationFrame(update)

                if (mixer!=null) mixer.update(delta * .33)

                controls.update(delta)

                //renderer.clear()
				renderer.render(scene, camera)

                if (recording_flight) flight_record.push([camera.position.x, camera.position.y, camera.position.z, camera.rotation.x, camera.rotation.y, camera.rotation.z])
                //console.log('[' + camera.position.x + ', ' + camera.position.y + ', ' + camera.position.z + ', ' + camera.rotation.x + ', ' + camera.rotation.y + ', ' + camera.rotation.z)

            } update()

            var recording_flight = false
            document.onkeypress = (e) => {
                var keynum;
                if (window.event) { // IE                  
                    keynum = e.keyCode;
                } else if(e.which) { // Netscape/Firefox/Opera                 
                    keynum = e.which;
                }
                keynum = String.fromCharCode(keynum)
                if (keynum == 'y' || keynum == 'Y') recording_flight = true
            }
            document.onkeyup = (e) => {
                var keynum;
                if (window.event) { // IE                  
                    keynum = e.keyCode;
                } else if(e.which) { // Netscape/Firefox/Opera                 
                    keynum = e.which;
                }
                keynum = String.fromCharCode(keynum)
                if (keynum == 'y' || keynum == 'Y') recording_flight = false

                if (keynum == 'r' || keynum == 'R') console.log(JSON.stringify(flight_record))
                if (keynum == 'g' || keynum == 'G') console.log('[' + camera.position.x + ', ' + camera.position.y + ', ' + camera.position.z + ', ' + camera.rotation.x + ', ' + camera.rotation.y + ', ' + camera.rotation.z + '],')
            }

            const font_loader = new THREE.FontLoader()
            var THREE_font

            font_loader.load( 'fonts/droid/droid_serif_regular.typeface.json', function ( font ) {
                THREE_font = font
            } )

            function write_smt(smt, x, y, z, x_, y_, z_) {
                var smt_ = ''
                for (let i = 0; i < smt.length; i++) {
                    smt_ += smt[i]
                    if ((i+1)%48==0) smt_ += '\n'
                }
                const geometry = new THREE.TextGeometry( smt_, {
                    font: THREE_font,
                    size: 6,
                    height: 1,
                } )
                const textMesh = new THREE.Mesh( geometry, new THREE.MeshNormalMaterial())
                textMesh.position.x = x
                textMesh.position.z = z
                textMesh.position.y = y
                textMesh.rotation.x = x_
                textMesh.rotation.z = z_
                textMesh.rotation.y = y_
                textMesh.scale.set(.016,.016,.016)
                scene.add(textMesh)
            }

		</script>

        <script>

            var username
            var password
            var entity_type

            async function main() {

                var stage = 0
                var stage_1_firsttime = true

                var div = document.createElement('div')
                document.body.appendChild(div)
                div.style.alignItems = 'center'
                div.style.justifyContent = 'center'
                div.style.position = 'absolute'
                div.style.top = '50%'
                div.style.left = '50%'
                div.style.transform = 'translate(-50%, -50%)'

                while (true)

                    switch (stage) {

                        case 0: 
                
                            var button_login = document.createElement('button')
                            var login_mouseover = false
                            button_login.innerHTML = 'Login'
                            button_login.style.color = 'white'
                            button_login.style.padding = '44px'
                            button_login.style.border = 'none' //'solid 1px white'
                            button_login.style.borderRadius = '10px'
                            button_login.style.outline = 'none'
                            button_login.style.fontFamily = 'Courier New'
                            button_login.style.fontSize = '16px'
                            button_login.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_login.onclick = () => {
                                div.removeChild(button_login)
                                div.removeChild(button_empty)
                                div.removeChild(button_guest)

                                var text_username = document.createElement('input')
                                div.appendChild(text_username)
                                text_username.type = 'text'
                                text_username.style.width = '666px'
                                text_username.placeholder = 'username'
                                text_username.style.color = 'white'
                                text_username.style.textAlign = 'center'
                                text_username.style.backgroundColor = 'transparent'
                                text_username.style.border = 'none'
                                text_username.style.outline = 'none'
                                text_username.style.fontSize = '18px'
                                text_username.style.fontFamily = 'Courier New'
                                text_username.style.backgroundColor = 'rgba(0,0,0,.44)'
                                text_username.style.padding = '6.66px'
                                
                                var text_password = document.createElement('input')
                                div.appendChild(text_password)
                                text_password.type = 'password'
                                text_password.style.width = '666px'
                                text_password.placeholder = 'password'
                                text_password.style.color = 'white'
                                text_password.style.textAlign = 'center'
                                text_password.style.backgroundColor = 'transparent'
                                text_password.style.border = 'none'
                                text_password.style.outline = 'none'
                                text_password.style.fontSize = '18px'
                                text_password.style.fontFamily = 'Courier New'
                                text_password.style.backgroundColor = 'rgba(0,0,0,.44)'
                                text_password.style.padding = '6.66px'

                                var button_proceed = document.createElement('button')
                                div.appendChild(button_proceed)
                                button_proceed.style.width = '666px'
                                button_proceed.innerHTML = 'Proceed'
                                button_proceed.style.color = 'white'
                                button_proceed.style.backgroundColor = 'transparent'
                                button_proceed.style.border = '2px solid white'
                                button_proceed.style.borderRadius = '20px'
                                button_proceed.style.border = 'none'
                                button_proceed.style.outline = 'none'
                                button_proceed.style.fontSize = '18px'
                                button_proceed.style.fontFamily = 'Courier New'
                                button_proceed.style.backgroundColor = 'rgba(0,0,0,.44)'
                                button_proceed.style.padding = '6.66px'
                                button_proceed.style.cursor = 'pointer'

                                button_proceed.onclick = function() {
                                    document.body.style.cursor = 'wait'
                                    if (text_username.value == '' || text_password.value == '') { 
                                        alert('Username/Password is not complete.')
                                        document.body.style.cursor = 'auto'
                                        return
                                    }
                                    async function go_fetch() {
                                        document.body.style.cursor = 'wait'
                                        var url = 'https://lisica.lisica.ai:64243/database'
                                        var xhr = new XMLHttpRequest();
                                        xhr.open("GET", url, true)
                                        xhr.setRequestHeader("username", text_username.value)
                                        xhr.setRequestHeader("password", text_password.value)
                                        xhr.setRequestHeader("cmd", "check_user")
                                        xhr.onreadystatechange = function() {
                                            if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
                                                var result = JSON.parse(xhr.responseText)
                                                if (result.answer == 'ACK.') {
                                                    username = text_username.value
                                                    password = text_password.value
                                                    div.removeChild(text_username)
                                                    div.removeChild(text_password)
                                                    div.removeChild(button_proceed)
                                                    stage = 1
                                                } else alert('Username/Password combination invalid.')
                                                document.body.style.cursor = 'auto'
                                            }
                                        }
                                        xhr.send()
                                    } go_fetch()
                                }
                            }
                            button_login.onmouseenter = () => {
                                login_mouseover = true
                                button_login.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_login.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_login.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .66 ? .66 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!login_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_login.onmouseleave = function() {
                                login_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_login.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_login.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (login_mouseover) return
                                    }
                                }
                                work()
                            }
                            
                            var button_empty = document.createElement('button')
                            button_empty.innerHTML = ''
                            button_empty.style.color = 'white'
                            button_empty.style.padding = '16px'
                            button_empty.style.backgroundColor = 'transparent'
                            button_empty.style.border = 'none'
                            button_empty.style.outline = 'none'
                            button_empty.style.fontSize = '16px'
                            
                            var button_guest = document.createElement('button')
                            var guest_mouseover = false
                            button_guest.innerHTML = 'Guest'
                            button_guest.style.color = 'white'
                            button_guest.style.padding = '44px'
                            button_guest.style.border = 'none' //'solid 1px white'
                            button_guest.style.borderRadius = '10px'
                            button_guest.style.outline = 'none'
                            button_guest.style.fontFamily = 'Courier New'
                            button_guest.style.fontSize = '16px'
                            button_guest.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_guest.onclick = () => {
                                stage = 1
                            }
                            button_guest.onmouseenter = () => {
                                guest_mouseover = true
                                button_guest.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_guest.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_guest.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .66 ? .66 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!guest_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_guest.onmouseleave = function() {
                                guest_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_guest.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_guest.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (guest_mouseover) return
                                    }
                                }
                                work()
                            }

                            div.appendChild(button_login)
                            div.appendChild(button_empty)
                            div.appendChild(button_guest)

                            while (stage==0) await sleep(.1)

                            break

                    // stage 1

                        case 1:

                            try {
                                div.removeChild(button_login)
                                div.removeChild(button_empty)
                                div.removeChild(button_guest)
                            } catch { }

                            if (stage_1_firsttime) {

                                if (camera_placings.length == 2) {
                                    const hm_seconds = 3
                                    const fps = 30
                                    var frame = 0
                                    const step = [
                                        (camera_placings[1][0]-camera_placings[0][0])/(fps*hm_seconds),
                                        (camera_placings[1][1]-camera_placings[0][1])/(fps*hm_seconds),
                                        (camera_placings[1][2]-camera_placings[0][2])/(fps*hm_seconds),
                                        (camera_placings[1][3]-camera_placings[0][3])/(fps*hm_seconds),
                                        (camera_placings[1][4]-camera_placings[0][4])/(fps*hm_seconds),
                                        (camera_placings[1][5]-camera_placings[0][5])/(fps*hm_seconds),
                                        
                                    ]
                                    //console.log('anim step:' + step)
                                    const sleep_for = 1/fps
                                    for (let i = 0; i < fps*hm_seconds; i++) {
                                        displace_camera(step)
                                        //frame +=1
                                        await sleep(sleep_for)
                                    }
                                } 
                                else { 
                                    for (let i = 0; i < camera_placings.length; i++) {
                                        place_camera(camera_placings[i])
                                        await sleep(.01)
                                    }
                                    place_camera(camera_placings[camera_placings.length-1])
                                }

                            }

                            div.style.display = 'flex'
                            //div.style.flexDirection = 'column'

                            var button_entity1 = document.createElement('button')
                            var entity1_mouseover = false
                            button_entity1.innerHTML = 'the dreaming one'
                            button_entity1.style.color = 'white'
                            button_entity1.style.border = 'none' //'solid 1px white'
                            button_entity1.style.borderRadius = '10px'
                            button_entity1.style.outline = 'none'
                            button_entity1.style.fontFamily = 'Courier New'
                            button_entity1.style.fontSize = '16px'
                            button_entity1.style.padding = '16px'
                            button_entity1.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity1.onclick = () => {
                                entity_type = 'the dreaming one'
                                stage = 2
                            }
                            button_entity1.onmouseenter = () => {
                                entity1_mouseover = true
                                button_entity1.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity1.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity1.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity1_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity1.onmouseleave = function() {
                                entity1_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity1.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity1.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity1_mouseover) return
                                    }
                                }
                                work()
                            }
                            
                            var button_empty = document.createElement('button')
                            button_empty.innerHTML = ''
                            button_empty.style.color = 'white'
                            button_empty.style.backgroundColor = 'transparent'
                            button_empty.style.border = 'none'
                            button_empty.style.outline = 'none'
                            button_empty.style.fontSize = '16px'
                            
                            var button_entity2 = document.createElement('button')
                            var entity2_mouseover = false
                            button_entity2.innerHTML = 'the perplexed one'
                            button_entity2.style.color = 'white'
                            button_entity2.style.border = 'none' //'solid 1px white'
                            button_entity2.style.borderRadius = '10px'
                            button_entity2.style.outline = 'none'
                            button_entity2.style.fontFamily = 'Courier New'
                            button_entity2.style.fontSize = '16px'
                            button_entity2.style.padding = '16px'
                            button_entity2.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity2.onclick = () => {
                                entity_type = 'the perplexed one'
                                stage = 2
                            }
                            button_entity2.onmouseenter = () => {
                                entity2_mouseover = true
                                button_entity2.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity2.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity2.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity2_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity2.onmouseleave = function() {
                                entity2_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity2.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity2.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity2_mouseover) return
                                    }
                                }
                                work()
                            }

                            var button_empty2 = document.createElement('button')
                            button_empty2.innerHTML = ''
                            button_empty2.style.color = 'white'
                            button_empty2.style.backgroundColor = 'transparent'
                            button_empty2.style.border = 'none'
                            button_empty2.style.outline = 'none'
                            button_empty2.style.fontSize = '16px'

                            var button_entity3 = document.createElement('button')
                            var entity3_mouseover = false
                            button_entity3.innerHTML = 'the unified one'
                            button_entity3.style.color = 'white'
                            button_entity3.style.border = 'none' //'solid 1px white'
                            button_entity3.style.borderRadius = '10px'
                            button_entity3.style.outline = 'none'
                            button_entity3.style.fontFamily = 'Courier New'
                            button_entity3.style.fontSize = '16px'
                            button_entity3.style.padding = '16px'
                            button_entity3.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity3.onclick = () => {
                                entity_type = 'the undivided one'
                                stage = 2
                            }
                            button_entity3.onmouseenter = () => {
                                entity3_mouseover = true
                                button_entity3.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity3.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity3.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity3_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity3.onmouseleave = function() {
                                entity3_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity3.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity3.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity3_mouseover) return
                                    }
                                }
                                work()
                            }

                            var button_empty3 = document.createElement('button')
                            button_empty3.innerHTML = ''
                            button_empty3.style.color = 'white'
                            button_empty3.style.backgroundColor = 'transparent'
                            button_empty3.style.border = 'none'
                            button_empty3.style.outline = 'none'
                            button_empty3.style.fontSize = '16px'

                            var button_entitymulti = document.createElement('button')
                            var entitymulti_mouseover = false
                            button_entitymulti.innerHTML = 'free floating\n[generated] ones'
                            button_entitymulti.style.color = 'white'
                            button_entitymulti.style.border = 'none' //'solid 1px white'
                            button_entitymulti.style.borderRadius = '10px'
                            button_entitymulti.style.outline = 'none'
                            button_entitymulti.style.fontFamily = 'Courier New'
                            button_entitymulti.style.fontSize = '16px'
                            button_entitymulti.style.padding = '12px'
                            button_entitymulti.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entitymulti.style.position = 'absolute'
                            button_entitymulti.style.top = '75%'
                            button_entitymulti.style.left = '50%'
                            button_entitymulti.style.transform = 'translate(-50%, -50%)'
                            button_entitymulti.onclick = () => {
                                entity_type = 'the obscure ones'
                                stage = 2
                            }
                            button_entitymulti.onmouseenter = () => {
                                entitymulti_mouseover = true
                                button_entitymulti.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entitymulti.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entitymulti.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entitymulti_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entitymulti.onmouseleave = function() {
                                entitymulti_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entitymulti.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entitymulti.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entitymulti_mouseover) return
                                    }
                                }
                                work()
                            }
                                  
                            div.appendChild(button_entity1)
                            div.appendChild(button_empty)
                            div.appendChild(button_entity2)
                            div.appendChild(button_empty2)
                            div.appendChild(button_entity3)
                            div.appendChild(button_empty3)
                            document.body.appendChild(button_entitymulti)
                            button_entitymulti.style.width = button_entity2.offsetWidth+'px'
            
                            while (stage==1) await sleep(.1)

                            break

                    // stage 2

                        case 2:

                            div.removeChild(button_entity1)
                            div.removeChild(button_empty)
                            div.removeChild(button_entity2)
                            div.removeChild(button_empty2)
                            div.removeChild(button_entity3)
                            div.removeChild(button_empty3)
                            document.body.removeChild(button_entitymulti)

                            //controls.lookSpeed = 0
                            //place_camera(camera_placings[camera_placings.length-1])
                            // console.log(controls.object.rotation) // todo rm me
                            // if (controls.object.rotation.x!=starting_pos[0]||controls.object.rotation.y!=starting_pos[1]||controls.object.rotation.z!=starting_pos[2])
                            //controls.lookAt(model_spirit.position.x, model_spirit.position.y, model_spirit.position.z)

                            // Todo: do the entity talking thingy here

                            var xhr = new XMLHttpRequest();
                            xhr.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                            xhr.setRequestHeader("username", username)
                            xhr.setRequestHeader("password", password)
                            xhr.setRequestHeader("cmd", "init")
                            xhr.setRequestHeader("template", entity_type)
                            xhr.onreadystatechange = function() {
                                if (xhr.readyState == XMLHttpRequest.DONE) {
                                    var result = JSON.parse(xhr.responseText)
                                    console.log(result)
                                    document.body.style.cursor = 'auto'
                                }
                            }
                            xhr.send()

                            if (entity_type!='the obscure ones') {

                                loader.load('spirit '+entity_type+'.glb', function ( gltf ) {
                                    model_spirit = gltf.scene
                                    model_spirit.rotateX(Math.PI/2)
                                    //scene.add(model_spirit)
                                    mixer = new THREE.AnimationMixer( model_spirit )
                                	mixer.clipAction( gltf.animations[ 2 ] ).play()
                                    model_spirit.name = "model_spirit"
                                    scene.add(model_spirit)
                                    model_spirit.position.x = camera_placings[camera_placings.length-1][0] + .936
                                    model_spirit.position.y = camera_placings[camera_placings.length-1][1] - .666
                                    model_spirit.position.z = camera_placings[camera_placings.length-1][2] - 3.666
                                    model_spirit.rotateZ(Math.PI/20)
                                })

                                //write_smt_ = (smt) => write_smt(smt, model_spirit.position.x-.2, model_spirit.position.y+2.6, model_spirit.position.z, 0, -Math.PI/8, 0)

                                var response = document.createElement('div')
                                response.style.position = 'absolute'
                                response.style.top = '6.666%'
                                response.style.left = '50%'
                                response.style.width = '366px'
                                response.style.textAlign = 'center'
                                document.body.appendChild(response)
                                //response.innerHTML = 'this is a sample response text'                   // TODO: make the buttons n stuff pretty
                                response.style.color = 'white'
                                response.style.fontFamily = 'Courier New'
                                response.style.fontSize = '16px'
                                
                                var reply = document.createElement('input')
                                reply.style.position = 'absolute'
                                reply.style.bottom = '6.666%'
                                reply.style.right = '39.6%'
                                reply.style.height = '26px'
                                reply.style.width = '336px'
                                reply.style.textAlign = 'center'
                                reply.style.color = 'white'
                                reply.style.borderRadius = '16px'
                                reply.style.backgroundColor = 'rgba(0,0,0,.666)'
                                reply.style.outline = 'none'
                                reply.style.border = 'none'
                                reply.placeholder = ' leave empty to keep generating ..'
                                //document.body.appendChild(reply)

                                var reset = document.createElement('button')
                                reset.style.position = 'absolute'
                                reset.style.bottom = '6.666%'
                                reset.style.right = '16.6%'
                                reset.style.width = '33.6px'
                                reset.style.height = '33.6px'
                                reset.style.border = 'none'
                                reset.style.cursor = 'pointer'
                                reset.style.backgroundColor = 'rgba(0,0,0,.0)'
                                reset.style.backgroundImage = 'url(reset.png)'
                                reset.style.backgroundSize = 'contain'
                                reset.style.backgroundPosition = 'center'
                                reset.style.backgroundRepeat = 'no-repeat'
                                //document.body.appendChild(reset)

                                var send = document.createElement('button')
                                send.style.position = 'absolute'
                                send.style.bottom = '6.666%'
                                send.style.right = '21.6%'
                                //send.style.textAlign = 'center'
                                //send.style.color = 'white'
                                //send.style.padding = '6px'
                                send.style.borderRadius = '16px'
                                //send.innerHTML = 'Generate'
                                send.style.backgroundColor = 'rgba(0,0,0,.0)'
                                send.style.backgroundImage = 'url(generate.png)'
                                send.style.backgroundSize = 'contain'
                                send.style.backgroundPosition = 'center'
                                send.style.backgroundRepeat = 'no-repeat'
                                send.style.width = '33.6px'
                                send.style.height = '33.6px'
                                send.style.border = 'none'
                                send.style.cursor = 'pointer'
                                document.body.appendChild(send)

                                send.onclick = () => {

                                    document.body.style.cursor = 'wait'

                                    if (username!=null) {

                                        response.innerHTML = '. . .'
                                        xhr = new XMLHttpRequest();
                                        xhr.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                                        xhr.setRequestHeader("username", username)
                                        xhr.setRequestHeader("password", password)
                                        xhr.setRequestHeader("cmd", "generate")
                                        xhr.setRequestHeader("reply", reply.value)
                                        xhr.setRequestHeader("template", entity_type)
                                        xhr.onreadystatechange = function() {
                                            if (xhr.readyState == XMLHttpRequest.DONE) {
                                                var result = JSON.parse(xhr.responseText)
                                                response.innerHTML = result.response
                                                document.body.style.cursor = 'auto'
                                            }
                                        }
                                        xhr.send()

                                    } else {

                                        response.innerHTML = 'todo:' // todo: do. examples
                                        document.body.style.cursor = 'auto'

                                    }
                                    reply.value = ''
                                    document.body.appendChild(reply)
                                    document.body.appendChild(reset)

                                }

                                reset.onclick = () => {

                                    stage_1_firsttime = false
                                    stage = 1
                                    response.innerHTML = ''
                                    document.body.removeChild(reply)
                                    document.body.removeChild(send)
                                    document.body.removeChild(reset)
                                    scene.remove(model_spirit)
                                    //console.log(renderer.info)

                                }

                            }

                            else {

                                controls.lookSpeed = .06
                                //controls.movementSpeed = .6

                            }

                            while (stage==2) await sleep(.1)

                            break

                    }

            } main()

        </script>

        <script>

            

            

        </script>

	</body>

</html>
