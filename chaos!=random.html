<html>

    <head>
      <title>Chaos != Random</title>
      <link rel="icon" type="image/x-icon" href="favicon.png">
      <script src="libs/p5.js"></script>
      <script src="libs/p5.rovercam.js"></script>
    </head>

    <body style="
          background-color: black;
          margin: 0;
          height: 100%;
          width: 100%;
          justify-content: center;
          align-items: center;
          cursor: wait;               
          ">
      
      <script>

        const skybox_size = 2_500

        const box_size = 50
        const box_locations = [
          [100, 0, 0],
          [200, 0, 100],
          [300, 0, -100],
        ]

        const floor_epsilon = .8
        var camera_y_lock = true

        const hm_lights = 3
        var lights_theta = []
        var lights_phi = []
        var lights_r = []
        var lights_hue = []
        var t = 0
        const t_delta = .1

        var canvas
        var cam

        function setup() {
  
          setAttributes('antialias', true)
          pixelDensity(1)
          //colorMode(HSB, 360)

          canvas = createCanvas(windowWidth, windowHeight, WEBGL)
          canvas.position((windowWidth-width)/2,0)

          //cam = createEasyCam()
          cam = createRoverCam()
          cam.usePointerLock()
          cam.setState({
            position: [0,0,0],
            rotation: [0,0,0],
            sensitivity: 0.006,
            speed: .2,
          })

          for (var i = 0; i < hm_lights; i++) {

            lights_theta.push(random(-1,1)*Math.PI*2)
            lights_phi.push(random(-1,1)*Math.PI*2)
            lights_r.push(skybox_size)//random(-1,1)*skybox_size/2)
            lights_hue.push(random()*360)

          }

          document.body.style.cursor = 'auto'

        }

        function draw() {

          background(0)

          for (var i = 0; i < hm_lights; i++) {

            let x = lights_r[i] * sin(lights_phi[i]) * cos(lights_theta[i])
            let y = lights_r[i] * sin(lights_phi[i]) * sin(lights_theta[i])
            let z = lights_r[i] * cos(lights_phi[i])

            //spotLight(lights_hue[i],255,255, x,y,z, x<0?1:-1,y<0?1:-1,z<0?1:-1, Math.PI/2, 255)

            // lights_theta[i] += random(-1,1)*Math.PI*2
            // lights_phi[i] += random(-1,1)*Math.PI*2
            // lights_r[i] += skybox_size//random(-1,1)*skybox_size/2)
            // lights_hue[i] += random()*360)

          }

          t +=t_delta

          spotLight(0,0,255, -skybox_size,0,0, 1,0,0, Math.PI/2, 255) // behind camera
          spotLight(0,255,255, 0,0,-skybox_size, 0,0,1, Math.PI/2, 255) // left of camera
          spotLight(255,0,255, 0,0,skybox_size, 0,0,-1, Math.PI/2, 255) // right of camera

          spotLight(255,0,0, 0,-skybox_size,0, 0,1,0, Math.PI/2, 255) // top of camera
          spotLight(255,255,0, 0,skybox_size,0, 0,-1,0, Math.PI/2, 255) // bot of camera

          stroke(0)
          fill(255)//0)
          box(skybox_size)

          for (var i = 0; i < box_locations.length; i++) {
            push()
            translate(box_locations[i][0], box_locations[i][1], box_locations[i][2])
            stroke(0)
            fill(255)
            box(box_size)
            pop()
          }

          if (camera_y_lock) {
            if (Math.abs(cam.position.y) <= floor_epsilon) cam.position.y = 0
            else cam.position.y /=1.016
          }
          else if (!camera_y_lock) {
            if (cam.position.y > skybox_size/4) cam.position.y = skybox_size/4
            else if (cam.position.y < -skybox_size/4) cam.position.y = -skybox_size/4
          }
          if (cam.position.x > skybox_size/4) cam.position.x = skybox_size/4
          else if (cam.position.x < -skybox_size/4) cam.position.x = -skybox_size/4
          if (cam.position.z > skybox_size/4) cam.position.z = skybox_size/4
          else if (cam.position.z < -skybox_size/4) cam.position.z = -skybox_size/4
          
        }

        this.onkeypress = function(event) {

          switch(event.keyCode) {

            case 13: // enter
              break

            case 32: // space
              camera_y_lock = !camera_y_lock
              break

            //default: alert(event.keyCode)

          }

        }

      </script>

    </body>

</html>