<html>

    <head>
      <title>MultiTrickFox's Space</title>
      <link rel="icon" type="image/x-icon" href="favicon.png">
    </head>
    
    <body style="
        background-color: black;
        margin: 0;
        height: 100%;
        width: 100%;
        justify-content: center;  
        cursor: wait;               
        ">

      <script>

        const audio = new Audio("audio.wav")

        audio.addEventListener('ended', function() {
          audio.currentTime = 0
          audio.volume /=2
          audio.play()
        }, false)

        var canvas = document.createElement('canvas')
        canvas.width = window.innerWidth
        canvas.height = window.innerHeight
        document.body.appendChild(canvas)
        var context = canvas.getContext('2d')

        var fontSize = 10
        var columns = canvas.width / fontSize
        var rows = canvas.height / fontSize
        var drops = []; for (var x = 0; x < columns; x++) drops[x] = 1

        var initial_drop_completed = false
        var waiting_button_press = false

        function draw() {

          context.fillStyle = 'rgba(0, 0, 0, 0.056)'
          context.fillRect(0, 0, canvas.width, canvas.height)

          if (waiting_button_press) return

          context.fillStyle = color
          context.font = fontSize + 'px monospace'

          for (var i = 0; i < drops.length; i++) {

            context.fillText(String.fromCharCode(Math.random()*128), i*fontSize, drops[i]*fontSize)

            if (drops[i] * fontSize > canvas.height && Math.random() > 0.987) {
              drops[i] = 0

              if (!initial_drop_completed) {
                initial_drop_completed = true
                waiting_button_press = true
                document.body.style.cursor = 'auto'
              }
            }
            drops[i]++
          }

        } setInterval(draw, 50)

        var hue = Math.floor(Math.random()*360)
        var color = 'hsl('+hue+', 100%, 50%)'
        const increment = 1
        
        function updateColor() {  

          hue = (hue + increment)
          if (hue >= 360) hue -=360
          color = 'hsl('+hue+', 100%, 50%)'

        } setInterval(updateColor, 300)

        var mouse_is_down = false

        this.onmousedown = function(event) {

          mouse_is_down = true

          if (event.target.tagName != 'CANVAS') return

          if (!initial_drop_completed) return

          if (waiting_button_press) {
            waiting_button_press = false
            audio.play()
          }  

        }

        this.onmouseup = function(event) {

          mouse_is_down = false

        }

        this.onmousemove = function(event) {

          if (initial_drop_completed && !waiting_button_press) { //&& mouse_is_down) {
            row = Math.floor(event.clientY / fontSize)
            col = Math.floor(event.clientX / fontSize) 
            drops[col] = row
          }

          if (initial_drop_completed && !waiting_button_press && event.clientX > 3*window.innerWidth/5)

            for (var i = 0; i < buttons.length; i++)

              buttons[i].style.opacity = 
                1 - Math.sqrt(
                  Math.pow(event.clientX - buttons[i].offsetLeft+buttons[i].offsetWidth/2, 2) + 
                  Math.pow(event.clientY - buttons[i].offsetTop+buttons[i].offsetHeight/2, 2)
                ) / (Math.max(window.innerHeight, window.innerWidth) - 3*window.innerWidth/5)

          else for (var i = 0; i < buttons.length; i++) buttons[i].style.opacity = 0

        }

        var buttons = [
          {
            text: 'Button 1',
            onclick: function() {
              document.body.style.cursor = 'wait'
              setInterval(function transition() {
                audio.volume /= 2
                if (audio.volume < .1)
                  //window.open('page0.html', '_blank');
                  window.location.href = 'page0.html'
              }, 426)
            }
          },
          {
            text: 'Button 2',
            onclick: function() {
            }
          },
          {
            text: 'Button 3',
            onclick: function() {
            }
          },
          {
            text: 'Button 4',
            onclick: function() {
            }
          }
        ]

        for (var i = 0; i < buttons.length; i++) {
          var button = document.createElement('button')
          document.body.appendChild(button)
          button.innerHTML = buttons[i].text
          button.onclick = buttons[i].onclick
          buttons[i] = button
          button.style.position = 'absolute'
          button.style.top = (i+1/2) * window.innerHeight / buttons.length + 'px'
          button.style.right = window.innerHeight / 70 + 'px'
          button.style.background = 'transparent'
          button.style.border = 'white'
          button.style.color = 'white'
          button.style.fontFamily = 'American Typewriter'
          button.style.fontSize = '12pt'
          button.style.cursor = 'pointer'
          button.style.opacity = 0
        }

        setInterval(function updateButtonColor() {
          for (var i = 0; i < buttons.length; i++) buttons[i].style.color = color;
        }, 300)

        this.onkeypress = function(event) {

          switch(event.keyCode) {

            case 13: // enter
              break

            case 32: // space
              break

            default: alert(event.keyCode)

          }

        }
          
      </script>

    </body>
    
</html>
