<html>

	<head>
		<title>mShrine</title>
	</head>

	<body
        style="
            background-color: black;
            margin: 0;
            height: 100%;
            width: 100%;
            justify-content: center;
            align-items: center;
        ">

        <script src="ThreeMin.js"></script>
        <script src="3js/loaders/GLTFLoader.js"></script>
        <script src="3js/loaders/FontLoader.js"></script>
        <script src="3js/controls/FirstPersonControls.js"></script>
        <script src="3js/geometries/TextGeometry.js"></script>
        
        <script> 
            const sleep = sec => new Promise(r => setTimeout(r, sec*1_000)) 
        </script>

		<script>

            const renderer = new THREE.WebGLRenderer({ antialias: true} )
            document.body.appendChild(renderer.domElement)
			renderer.setSize(window.innerWidth, window.innerHeight)

			const scene = new THREE.Scene()

			const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000)
            camera.rotateY(-1.7)
            camera.position.x = 15.6
            camera.position.z = 1.766
            camera.position.y = -.16
            camera.rotateY(-.126)

            // const controls = new THREE.OrbitControls(camera, renderer.domElement)
            // controls.minDistance = 0
            // controls.maxDistance = 99999999

            const controls = new THREE.FirstPersonControls(camera, renderer.domElement)
            controls.movementSpeed = 0
            controls.lookSpeed = 0.06
            controls.verticalMax = Math.PI*3/4
            controls.verticalMin = Math.PI/4

            const light = new THREE.AmbientLight()
            light.castShadow = true
            scene.add(light)
            // const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            // ambientLight.castShadow = true
            // scene.add(ambientLight)

			// const geometry = new THREE.BoxGeometry( 1, 1, 1 )
			// const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )
			// const cube = new THREE.Mesh( geometry, material )
			// scene.add(cube)

            const loader = new THREE.GLTFLoader()

            loader.load('shrine.glb', function ( gltf ) {
                const model = gltf.scene
                scene.add(model)
            })

            loader.load('stairs.glb', function ( gltf ) {
                const model = gltf.scene
                model.rotateY(-45)
                model.position.y = -6
                model.position.x = -18.6
                model.position.z = -2.8
                scene.add(model)
            })

            loader.load('spirit.glb', function ( gltf ) {
                const model = gltf.scene
                model.position.x = 18.6
                model.position.z = 2.62
                model.position.y = -1.2
                model.rotateX(Math.PI/2)
                model.rotateZ(Math.PI/2+Math.PI/16)

                mixer = new THREE.AnimationMixer( model );
				mixer.clipAction( gltf.animations[ 2 ] ).play();

                scene.add(model)

            })

            
            const clock = new THREE.Clock()

            var mixer = null

			function update() {

                var delta = clock.getDelta()

                requestAnimationFrame(update)

                if (mixer!=null) mixer.update(delta * .33)

                controls.update(delta)

                //renderer.clear()

				renderer.render(scene, camera)

            } update()

            const font_loader = new THREE.FontLoader()

            font_loader.load( 'fonts/droid/droid_serif_regular.typeface.json', function ( font ) {

                const geometry = new THREE.TextGeometry( 'Hello world.js!', {
                    font: font,
                    size: 10,
                    height: 2,
                    // curveSegments: 12,
                    // bevelEnabled: true,
                    // bevelThickness: 10,
                    // bevelSize: 8,
                    // bevelOffset: 0,
                    // bevelSegments: 5
                } )

                const textMesh = new THREE.Mesh( geometry, new THREE.MeshNormalMaterial())

                textMesh.position.x = 17
                textMesh.position.z = 2.62
                textMesh.position.y = .2
                textMesh.rotateY(-Math.PI/2-Math.PI/5)
                textMesh.scale.set(.01,.01,.01)

                scene.add(textMesh)

            } )

		</script>

	</body>

</html>
